{% comment %} This file is auto-generated. Do not edit this file. {% endcomment %}
{% comment %} This file is auto-generated. Do not edit this file. {% endcomment %}
{%- liquid
  assign show_debugger_on_fe = false
  assign show_debugger_on_be = false
  if section.settings.show_debugger_fe
    assign show_debugger_on_fe = true
  endif
  if section.settings.show_debugger_be
    assign show_debugger_on_be = true
  endif
-%}

<div
  style='
    {% unless show_debugger_on_fe %} display: none;{% endunless %}
    {% if request.design_mode and show_debugger_on_be %}
        display: block;
    {% endif %}
  '
>
  <h2>
    Redirect Rules
    {% if show_debugger_on_be and show_debugger_on_fe == false %}
      (this is only visible from the customizer, no visitors can see this)
    {% endif %}
    {% if show_debugger_on_fe %}
      <br>
      -- THIS IS VISIBLE TO SITE VISITORS --
      <br>
      UNCHECK 'Display Redirect Rules on Frontend' OPTION UNLESS ON A DEV THEME
    {% endif %}
  </h2>
  {% for block in section.blocks %}
    <div style='margin-left: 2rem; margin-top: 2rem;' {{ block.shopify_attributes }}>
      {% case block.type %}
        {% when 'url_param', 'cookie' %}
          <!-- Alpine Plugin (before Alpine) -->
          <script defer src='https://cdn.jsdelivr.net/gh/jdunham2/alpinejs-history@1.x.x/index.min.js'></script>
          <script defer src='https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js'></script>
          <!-- Core Alpine -->
          <script defer src='https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js'></script>
          {%- liquid
            assign block_type = 'URL Parameter'
            assign storage_method = '$history("")'

            # We optionally store the value in the browser session for URL parameters
            if block.type == 'url_param' and block.settings.persist
              assign storage_method = '$history($persist(""))'
            endif

            # If the block type is cookie, we need to use the $persist method to store the value
            if block.type == 'cookie'
              assign block_type = 'Cookie'
              assign storage_method = '$persist("")'
            endif
          -%}

          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Type:</span>
            {{ block_type }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Parameter Name:</span>
            {{ block.settings.key }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Condition:</span>
            {{ block.settings.match_condition }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Value:</span>
            {{ block.settings.value }}
          </div>

          <!-- $history magic will initialize to the url search param if present -->
          <div x-data='{ "{{ block.settings.key }}": {{ storage_method }} }'>
            <div style='margin-left: 2rem;'>
              <div>Actual Value: <span x-text="$data['{{ block.settings.key }}']"></span></div>
              {% if block.settings.match_condition == 'equals' %}
                Condition Equal Matches:
                {% if request.design_mode or section.settings.disable == true %}
                  <div
                    x-show="$data['{{ block.settings.key }}'] == '{{ block.settings.value }}'"
                    style='font-size: 32px;'
                  >
                    Would redirect now to:
                    <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
                  </div>
                {% else %}
                  <span
                    x-effect="$data['{{ block.settings.key }}'] == '{{ block.settings.value }}' && window.location.replace('{{ block.settings.redirect_to }}')"
                  ></span>
                {% endif %}
              {% elsif block.settings.match_condition == 'not_equals' %}
                Condition Not Equal Matches:
                {% if request.design_mode or section.settings.disable == true %}
                  <div
                    x-show="$data['{{ block.settings.key }}'] != '{{ block.settings.value }}'"
                    style='font-size: 32px;'
                  >
                    Would redirect now to:
                    <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
                  </div>
                {% else %}
                  <span
                    x-effect="$data['{{ block.settings.key }}'] != '{{ block.settings.value }}' && window.location.replace('{{ block.settings.redirect_to }}')"
                  ></span>
                {% endif %}
              {% elsif block.settings.match_condition == 'contains' %}
                Condition Contain Matches:
                {% if request.design_mode or section.settings.disable == true %}
                  <div
                    x-show="$data['{{ block.settings.key }}'].includes('{{ block.settings.value }}')"
                    style='font-size: 32px;'
                  >
                    Would redirect now to:
                    <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
                  </div>
                {% else %}
                  <span
                    x-effect="$data['{{ block.settings.key }}'].includes('{{ block.settings.value }}') && window.location.replace('{{ block.settings.redirect_to }}')"
                  ></span>
                {% endif %}
              {% elsif block.settings.match_condition == 'not_contains' %}
                Condition Not Contain Matches:
                {% if request.design_mode or section.settings.disable == true %}
                  <div
                    x-show="!$data['{{ block.settings.key }}'].includes('{{ block.settings.value }}')"
                    style='font-size: 32px;'
                  >
                    Would redirect now to:
                    <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
                  </div>
                {% else %}
                  <span
                    x-effect="!$data['{{ block.settings.key }}'].includes('{{ block.settings.value }}') && window.location.replace('{{ block.settings.redirect_to }}')"
                  ></span>
                {% endif %}
              {% else %}

              {% endif %}
            </div>
          </div>
        {% when 'product_tag' %}
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Type:</span>
            Product Tag
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Condition:</span>
            {{ block.settings.match_condition }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Value:</span>
            {{ block.settings.value }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Redirect To:</span>
            {{ block.settings.redirect_to }}
          </div>

          {% if block.settings.match_condition == 'equals' %}
            {% if product.tags contains block.settings.value %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% elsif block.settings.match_condition == 'not_equals' %}
            {% assign has_tag = false %}
            {% if product.tags contains block.settings.value %}
              {% assign has_tag = true %}
            {% endif %}
            {% if has_tag == false %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% elsif block.settings.match_condition == 'contains' %}
            <div style='margin-left: 2rem;'>
              <span style='text-transform: uppercase; font-size: 12px;'>Condition Equal Contains: false</span>
            </div>
            {% for tag in product.tags %}
              {% if tag contains block.settings.value %}
                {% if request.design_mode or section.settings.disable == true %}
                  <div style='font-size: 32px;'>Would redirect now to:</div>
                  <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
                {% else %}
                  <script>
                    window.location.replace('{{ block.settings.redirect_to }}');
                  </script>
                {% endif %}
              {% endif %}
            {% endfor %}
          {% elsif block.settings.match_condition == 'not_contains' %}
            {% assign should_redirect = true %}
            {% for tag in product.tags %}
              {% if tag contains block.settings.value %}
                {% assign should_redirect = false %}
                {% break %}
              {% endif %}
            {% endfor %}
            {% if should_redirect %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% else %}

          {% endif %}
        {% when 'product_title' %}
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Type:</span>
            Product Title
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Condition:</span>
            {{ block.settings.match_condition }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Match Value:</span>
            {{ block.settings.value }}
          </div>
          <div>
            <span style='text-transform: uppercase; font-size: 12px;'>Redirect To:</span>
            {{ block.settings.redirect_to }}
          </div>

          {% if block.settings.match_condition == 'equals' %}
            {% if product.title == block.settings.value %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% elsif block.settings.match_condition == 'not_equals' %}
            {% if product.title != block.settings.value %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% elsif block.settings.match_condition == 'contains' %}
            <div style='margin-left: 2rem;'>
              <span style='text-transform: uppercase; font-size: 12px;'>Condition Equal Contains: false</span>
            </div>
            {% if product.title contains block.settings.value %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% elsif block.settings.match_condition == 'not_contains' %}
            {% assign has_text = false %}
            {% if product.title contains block.settings.value %}
              {% assign has_text = true %}
            {% endif %}
            {% if has_text == false %}
              {% if request.design_mode or section.settings.disable == true %}
                <div style='font-size: 32px;'>Would redirect now to:</div>
                <a href='{{ block.settings.redirect_to }}'>{{ block.settings.redirect_to }}</a>
              {% else %}
                <script>
                  window.location.replace('{{ block.settings.redirect_to }}');
                </script>
              {% endif %}
            {% endif %}
          {% else %}

          {% endif %}
      {% endcase %}
    </div>
  {% endfor %}
</div>

{% schema %}
{
  "name": "SS✧Redirect Rules",
  "settings": [
    {
      "type": "header",
      "content": "Redirect Rules"
    },
    {
      "type": "checkbox",
      "id": "disable",
      "label": "Disable All Redirect Rules",
      "default": false,
      "info": "You will still be able to see the debug results."
    }
  ],
  "blocks": [
    {
      "type": "url_param-v-1-0",
      "name": "Matches URL Parameter",
      "settings": [
        {
          "type": "text",
          "id": "key",
          "label": "URL Parameter",
          "info": "Key in key value pairs. Example: ?key=value"
        },
        {
          "type": "select",
          "id": "match_condition",
          "label": "Match When",
          "options": [
            {
              "value": "equals",
              "label": "Equal to"
            },
            {
              "value": "not_equals",
              "label": "Not equal to"
            },
            {
              "value": "contains",
              "label": "Contains"
            },
            {
              "value": "not_contains",
              "label": "Does not contain"
            },
            {
              "value": "empty",
              "label": "Is empty"
            },
            {
              "value": "not_empty",
              "label": "Is not empty"
            }
          ]
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value"
        },
        {
          "type": "url",
          "id": "redirect_to",
          "label": "Redirect To"
        },
        {
          "type": "checkbox",
          "id": "persist",
          "label": "Store Value in Session",
          "default": true,
          "info": "If checked, this rule will apply any time the user visits this page during their current session."
        }
      ]
    },
    {
      "type": "product_tag-v-1-0",
      "name": "Matches Product Tag",
      "settings": [
        {
          "type": "text",
          "id": "key",
          "label": "Tag Name",
          "info": "Key in key value pairs. Example: ?key=value"
        },
        {
          "type": "select",
          "id": "match_condition",
          "label": "Match When",
          "options": [
            {
              "value": "equals",
              "label": "Equal to"
            },
            {
              "value": "not_equals",
              "label": "Not equal to"
            },
            {
              "value": "contains",
              "label": "Contains"
            },
            {
              "value": "not_contains",
              "label": "Does not contain"
            },
            {
              "value": "empty",
              "label": "Is empty"
            },
            {
              "value": "not_empty",
              "label": "Is not empty"
            }
          ]
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value"
        },
        {
          "type": "url",
          "id": "redirect_to",
          "label": "Redirect To"
        }
      ]
    },
    {
      "type": "product_title-v-1-0",
      "name": "Matches Product Title",
      "settings": [
        {
          "type": "text",
          "id": "key",
          "label": "Title",
          "info": "Key in key value pairs. Example: ?key=value"
        },
        {
          "type": "select",
          "id": "match_condition",
          "label": "Match When",
          "options": [
            {
              "value": "equals",
              "label": "Equal to"
            },
            {
              "value": "not_equals",
              "label": "Not equal to"
            },
            {
              "value": "contains",
              "label": "Contains"
            },
            {
              "value": "not_contains",
              "label": "Does not contain"
            },
            {
              "value": "empty",
              "label": "Is empty"
            },
            {
              "value": "not_empty",
              "label": "Is not empty"
            }
          ]
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value"
        },
        {
          "type": "url",
          "id": "redirect_to",
          "label": "Redirect To"
        }
      ]
    },
    {
      "type": "cookie-v-1-0",
      "name": "Matches Session Cookie",
      "settings": [
        {
          "type": "text",
          "id": "key",
          "label": "Cookie Key",
          "info": "Key in key value pairs. Example: ?key=value"
        },
        {
          "type": "select",
          "id": "match_condition",
          "label": "Match When",
          "options": [
            {
              "value": "equals",
              "label": "Equal to"
            },
            {
              "value": "not_equals",
              "label": "Not equal to"
            },
            {
              "value": "contains",
              "label": "Contains"
            },
            {
              "value": "not_contains",
              "label": "Does not contain"
            },
            {
              "value": "empty",
              "label": "Is empty"
            },
            {
              "value": "not_empty",
              "label": "Is not empty"
            }
          ]
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value"
        },
        {
          "type": "url",
          "id": "redirect_to",
          "label": "Redirect To"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "SS✧Redirect Rules",
      "blocks": [
        {
          "type": "url_param-v-1-0"
        }
      ]
    }
  ]
}
{% endschema %}
